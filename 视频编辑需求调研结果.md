# ScreenRecorder视频编辑需求调研结果

## 需求

|  代号   | 需求  | FFmpeg命令(输入input.mp4，输出output.mp4) | 含义 |
|  :-:  | :-: | :-:| :-: |
| cut  | 视频时长裁剪 | ```ffmpeg -ss 10 -t 3600 -i input.mp4 -codec copy output.mp4``` | 裁剪视频时长，从第10秒开始，共3600秒 |
| crop  | 视频画面比例裁剪，自由拖动设置大小和固定大小 | ```ffmpeg -i input.mp4 -filter:v "crop=w:h:x:y" output.mp4``` | 裁剪视频画幅，宽、高、x坐标、y坐标分别为w、h、x、y |
| rotate  | 视频旋转：90度旋转、自由角度旋转（-45度至45度） | ```ffmpeg -i input.mp4 -vf "rotate=-45*PI/180" output.mp4``` | 视频逆时针旋转45度 |
| flip  | 视频翻转（镜像） | ```ffmpeg -i input.mp4 -vf hflip output.mp4``` | 水平翻转 |
| waterMark  | 添加文本、水印 | ```ffmpeg -i input.mp4 -vf "drawtext=text='Hello FFmpeg':enable='between(t,0,5)': x=(w-text_h)/2: y=(h-text_h)/2: fontsize=32: fontcolor=#FFFFFF: box=1: boxcolor=black@0.5: boxborderw=5:" -c:a copy output.mp4``` | 在视屏中央位置添加半透明黑底、白色文字“Hello FFmpeg” |
| volume  | 音量大小调整 | ```ffmpeg -i input.mp4 -af "volume=3" output.mp4``` | 音量提升为原来的三倍 |
| concat | 多个视频文件拼接 |  ```fmpeg -i input1.mp4 -i input2.mp4 -i input3.mov-filter_complex "[0:v:0][0:a:0][1:v:0][1:a:0][2:v:0][2:a:0]concat=n=2:v=1:a=1[outv][outa]" -map "[outv]" -map "[outa]" output.mp4``` | 将input2追加到input1之后 |
| bgm  | 添加背景音乐 | ```ffmpeg -i input.mp4 -i bgm.mp3 -map 0:v -map 1:a -shortest output.mp4``` | 将bgm作为input的背景音乐，输出视频时长等于两个输入源中较小的长度 |
| filter  | 画面设置（基础滤镜）亮度、对比度、饱和度、锐化、色温、色调 | ```ffmpeg -i input.mp4 -vf eq=brightness=-0.5 output.mp4``` | 调整画面亮度至源视频的一半 |

### 上述命令耗时情况
只有cut耗时短，能够瞬间完成，其余指令执行时长均取决于源视频的大小。原因是，只有cut没有对源视频或音频画面进行更改，只截取了源视频的一部分，无需对音频和视频进行重新编码；其他操作至少对音频、视频中的其中一个进行重新编码，因而耗时较长。

## 两个Android视音频编辑库：[RxFFmpeg](https://github.com/microshow/RxFFmpeg)、[FFmpegCommand](https://github.com/AnJoiner/FFmpegCommand)

- 共同点：[在FFmpeg基础上编译so库](https://github.com/AnJoiner/FFmpegCommand/blob/master/ffmpeg-wiki/%E7%BC%96%E8%AF%91FFmpeg.md)，完成Java与Native交互，提供API支持执行任意FFmpeg命令，监听当前任务进度，理论上能够实现FFmpeg全部功能；均提供标准版和lite版。
即便是lite版，两种常用cpu架构下的so库体积仍高达10M左右。
- 不同点：FFmpegCommand没有异步API，对常用命令进行了封装。

## 需求实现的难易程度

### UI的实现
- 美摄SDKDemo主要通过按钮和SeekBar（Slider）来进行交互，但部分场景需要设计自定义绘制和手势控制，实现难度中等。
- 剪映将所有交互基本集成在一个View上，且多以滑动为主，大量的刻度和各种各样的滑块，需要自定义实现，带来的用户体验较好，操作相当优雅。但实现难度较大。

### 视频制作
上述需求多为基础的视频编辑需求，只需要查询到对应命令行即可实现。但实现较为复杂的需求，需要对操作符有足够了解。

## 视频预览
已知几乎上述全部需求通过FFmpeg进行视频制作都是相当耗时的，因此视频编辑结果的预览需要采用高效的模拟实现效果的方式。以添加水印和滤镜为例，可以通过在视频上方
悬浮一个ImageView来模拟水印，通过OpenGL shader来模拟滤镜。虽然两者实现方式大概相同，但两者的实现难度确是无法相提并论的。

## 总结上述需求的实现难度
实现难度大致分为三个档次：
- 低：目前知识储备足以完成。
- 中：需要少量时间去研究实现方式。
- 高：需要大量时间去研究实现方式、实现原理，甚至深入视音频领域。

|  代号   | 需求  | 实现难度 | 难点 |
|  :-:  | :-: | :-:| :-: |
| cut  | 视频时长裁剪 | 低 | 无需模拟实现，可通过FFmepg直接操作，较为简单 |
| crop  | 视频画面比例裁剪，自由拖动设置大小和固定大小 | 中 | 考虑通过修改SurfaceView的尺寸实现感官上的裁剪 |
| rotate  | 视频旋转：90度旋转、自由角度旋转（-45度至45度） | 中 | 考虑通过旋转SurfaceView角度实现感官上的旋转 |
| flip  | 视频翻转（镜像） | 高 | OpenGL |
| waterMark  | 添加文本、水印 | 低 | 悬浮View，较为简单 |
| volume  | 音量大小调整 | 中 | 音视频分离 |
| concat | 多个视频文件拼接 |  低 | 多个视频顺序播放，较为简单  |
| bgm  | 添加背景音乐 | 中 | 音视频分离 |
| filter  | 画面设置（基础滤镜）亮度、对比度、饱和度、锐化、色温、色调 | 高 | OpenGL、sharder、GLSL |
